<!-- public/login.html -->
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Enterprise Login</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
            body {
                font-family: "Inter", sans-serif;
            }
        </style>
    </head>
    <body class="bg-gray-100 flex items-center justify-center h-screen">
        <div class="w-full max-w-md">
            <div class="bg-white shadow-lg rounded-lg p-8">
                <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">
                    Enterprise Portal Login
                </h2>
                <form id="login-form">
                    <div class="mb-4">
                        <label
                            for="username"
                            class="block text-gray-700 text-sm font-bold mb-2"
                            >Username</label
                        >
                        <input
                            type="text"
                            id="username"
                            name="username"
                            required
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        />
                    </div>
                    <div class="mb-6">
                        <label
                            for="password"
                            class="block text-gray-700 text-sm font-bold mb-2"
                            >Password</label
                        >
                        <input
                            type="password"
                            id="password"
                            name="password"
                            required
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline"
                        />
                    </div>
                    <div class="flex items-center justify-between">
                        <button
                            type="submit"
                            class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full"
                        >
                            Sign In
                        </button>
                    </div>
                </form>
                <p
                    id="error-message"
                    class="mt-4 text-center text-red-500 text-sm"
                ></p>
            </div>
        </div>

        <script>
            const loginForm = document.getElementById("login-form");
            const errorMessage = document.getElementById("error-message");

            loginForm.addEventListener("submit", async (e) => {
                e.preventDefault();
                errorMessage.textContent = "";

                const username = document.getElementById("username").value;
                const password = document.getElementById("password").value;

                try {
                    const response = await fetch("/api/auth/login", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ username, password }),
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.message || "Login failed.");
                    }

                    localStorage.setItem("accessToken", data.accessToken);

                    const tokenPayload = JSON.parse(
                        atob(data.accessToken.split(".")[1])
                    );
                    if (tokenPayload.role === "superadmin") {
                        // Redirect to /admin route
                        window.location.href = "/admin";
                    } else {
                        // Redirect to /dashboard route
                        window.location.href = "/dashboard";
                    }
                } catch (error) {
                    errorMessage.textContent = error.message;
                }
            });
        </script>
    </body>
</html>
